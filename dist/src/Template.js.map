{"version":3,"sources":["Template.js"],"names":[],"mappings":";;;;;;;;sBAAc,QAAQ;;;;wBACD,YAAY;;;;wBACb,UAAU;;;;AAE9B,MAAM,SAAS,CAAC;AACZ,eAAW,CAAC,KAAK,EAAE;AACf,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;KACtB;;AAED,YAAQ,GAAG;AACP,eAAO,IAAI,CAAC,KAAK,CAAC;KACrB;CACJ;;;;;AAKD,MAAM,QAAQ,CAAC;AACX,eAAW,CAAC,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE;AACjD,YAAI,CAAC,CAAC,mBAAI,CAAC;AACX,YAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC1B,YAAI,CAAC,SAAS,GAAG,mBAAQ,SAAS,CAAC,QAAQ,CAAC,CAAC;AAC7C,YAAI,CAAC,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AACvB,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;AACnB,YAAI,CAAC,OAAO,GAAG;AACX,mBAAO,EAAE,EAAE;SACd,CAAC;AACF,YAAI,CAAC,aAAa,GAAG,SAAS,CAAC;AAC/B,YAAI,CAAC,OAAO,GAAG;AACX,aAAC,EAAE,IAAI,CAAC,CAAC;AACT,eAAG,EAAE,IAAI,CAAC,GAAG;SAChB,CAAC;KACL;;AAED,YAAQ,GAAG;AACP,eAAO,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,MAAM;AAC/B,gBAAI,IAAI,CAAC,OAAO,KAAK,SAAS,EAAE;AAC5B,uBAAO,IAAI,CAAC,OAAO,CAAC;aACvB;AACD,mBAAO,uBAAa,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC;SACpH,CAAC,CAAC;KACN;;AAED,cAAU,CAAC,GAAG,EAAE;AACZ,YAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,SAAS,EAAE;AAChD,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,GAAG,CAAC;SAC1C,MAAM;AACH,gBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,GAAG,CAAC;SAC3C;KACJ;;AAED,WAAO,CAAC,GAAG,EAAE;AACT,YAAI,GAAG,YAAY,SAAS,EAAE;AAC1B,gBAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;SACxB,MAAM;AACH,gBAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;SACnD;KACJ;;AAED,OAAG,CAAC,GAAG,EAAE;AACL,eAAO,IAAI,SAAS,CAAC,GAAG,CAAC,CAAC;KAC7B;;AAED,YAAQ,CAAC,IAAI,EAAE;AACX,eAAO,uBAAa,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC;KAC9F;CACJ;;kBAEc,QAAQ","file":"Template.js","sourcesContent":["import _ from 'lodash';\r\nimport Compiler from './Compiler';\r\nimport Promise from 'bluebird';\r\n\r\nclass RawString {\r\n    constructor(value) {\r\n        this.value = value;\r\n    }\r\n\r\n    toString() {\r\n        return this.value;\r\n    }\r\n}\r\n\r\n/**\r\n * A compiled template.\r\n */\r\nclass Template {\r\n    constructor(compiler, evaluate, data, child, escape) {\r\n        this._ = _;\r\n        this._compiler = compiler;\r\n        this._evaluate = Promise.coroutine(evaluate);\r\n        this.data = data || {};\r\n        this.child = child;\r\n        this._result = {\r\n            content: ''\r\n        };\r\n        this._currentBlock = 'content';\r\n        this._locals = {\r\n            _: this._,\r\n            raw: this.raw\r\n        };\r\n    }\r\n\r\n    _execute() {\r\n        return this._evaluate().then(() => {\r\n            if (this._layout === undefined) {\r\n                return this._result;\r\n            }\r\n            return new Compiler(this._compiler.arc, this._compiler.joinedPath(this._layout), this.data, this._result).load();\r\n        });\r\n    }\r\n\r\n    _appendRaw(str) {\r\n        if (this._result[this._currentBlock] === undefined) {\r\n            this._result[this._currentBlock] = str;\r\n        } else {\r\n            this._result[this._currentBlock] += str;\r\n        }\r\n    }\r\n\r\n    _append(str) {\r\n        if (str instanceof RawString) {\r\n            this._appendRaw(str);\r\n        } else {\r\n            this._appendRaw(this._compiler.arc.escape(str));\r\n        }\r\n    }\r\n\r\n    raw(str) {\r\n        return new RawString(str);\r\n    }\r\n\r\n    _partial(path) {\r\n        return new Compiler(this._compiler.arc, this._compiler.joinedPath(path), this.data).load();\r\n    }\r\n}\r\n\r\nexport default Template;"],"sourceRoot":"/source/"}