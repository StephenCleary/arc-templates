{"version":3,"sources":["Context.js"],"names":[],"mappings":";;;;;;;;;;;;sBAAc,QAAQ;;;;wBACD,YAAY;;;;wBACb,UAAU;;;;IAExB,SAAS;AACA,aADT,SAAS,CACC,KAAK,EAAE;8BADjB,SAAS;;AAEP,YAAI,CAAC,KAAK,GAAG,KAAK,CAAC;KACtB;;;;;;iBAHC,SAAS;;eAKH,oBAAG;AACP,mBAAO,IAAI,CAAC,KAAK,CAAC;SACrB;;;WAPC,SAAS;;;IAaT,OAAO;AACE,aADT,OAAO,CACG,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE;;;8BADxC,OAAO;;AAEL,YAAI,CAAC,CAAC,sBAAI,CAAC;AACX,YAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC1B,YAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,GACpC;mBAAM,sBAAQ,SAAS,CAAC,QAAQ,CAAC,IAAI,OAAM,CAAC,CAAC,IAAI,OAAM;SAAA,GACvD,sBAAQ,SAAS,CAAC,QAAQ,CAAC,CAAC;AAChC,YAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC1B,YAAI,CAAC,OAAO,GAAG;AACX,aAAC,EAAE,IAAI,CAAC,CAAC;AACT,eAAG,EAAE,IAAI,CAAC,GAAG;SAChB,CAAC;KACL;;iBAZC,OAAO;;eAcD,kBAAC,IAAI,EAAE,KAAK,EAAE;;;AAClB,gBAAI,CAAC,OAAO,GAAG;AACX,uBAAO,EAAE,EAAE;aACd,CAAC;AACF,gBAAI,CAAC,aAAa,GAAG,SAAS,CAAC;AAC/B,gBAAI,CAAC,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AACvB,gBAAI,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAI,KAAK,CAAC;AACzC,mBAAO,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,YAAM;AAC/B,oBAAI,OAAK,OAAO,KAAK,SAAS,EAAE;AAC5B,2BAAO,OAAK,OAAO,CAAC;iBACvB;AACD,uBAAO,sBAAS,QAAQ,CAAC,OAAK,SAAS,CAAC,GAAG,EAAE,OAAK,SAAS,CAAC,UAAU,CAAC,OAAK,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAK,IAAI,EAAE,OAAK,OAAO,CAAC,CAAC;aAC3H,CAAC,CAAC;SACN;;;eAES,oBAAC,GAAG,EAAE;AACZ,gBAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,SAAS,EAAE;AAChD,oBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,GAAG,CAAC;aAC1C,MAAM;AACH,oBAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,GAAG,CAAC;aAC3C;SACJ;;;eAEM,iBAAC,GAAG,EAAE;AACT,gBAAI,GAAG,YAAY,SAAS,EAAE;AAC1B,oBAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;aACxB,MAAM;AACH,oBAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;aACnD;SACJ;;;eAEE,aAAC,GAAG,EAAE;AACL,mBAAO,IAAI,SAAS,CAAC,GAAG,CAAC,CAAC;SAC7B;;;eAEO,kBAAC,IAAI,EAAE;AACX,mBAAO,sBAAS,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACrG;;;WAnDC,OAAO;;;qBAsDE,OAAO","file":"Context.js","sourcesContent":["import _ from 'lodash';\r\nimport Template from './Template';\r\nimport Promise from 'bluebird';\r\n\r\nclass RawString {\r\n    constructor(value) {\r\n        this.value = value;\r\n    }\r\n\r\n    toString() {\r\n        return this.value;\r\n    }\r\n}\r\n\r\n/**\r\n * The context in which a template executes.\r\n */\r\nclass Context {\r\n    constructor(template, evaluate, filename) {\r\n        this._ = _;\r\n        this._template = template;\r\n        this._evaluate = template.arc.supportES5 ?\r\n            () => Promise.coroutine(evaluate.call(this)).call(this) :\r\n            Promise.coroutine(evaluate);\r\n        this._filename = filename;\r\n        this._locals = {\r\n            _: this._,\r\n            raw: this.raw\r\n        };\r\n    }\r\n\r\n    _execute(data, child) {\r\n        this._result = {\r\n            content: ''\r\n        };\r\n        this._currentBlock = 'content';\r\n        this.data = data || {};\r\n        this.child = this._locals.child =  child;\r\n        return this._evaluate().then(() => {\r\n            if (this._layout === undefined) {\r\n                return this._result;\r\n            }\r\n            return Template.fromFile(this._template.arc, this._template.joinedPath(this._layout)).evaluate(this.data, this._result);\r\n        });\r\n    }\r\n\r\n    _appendRaw(str) {\r\n        if (this._result[this._currentBlock] === undefined) {\r\n            this._result[this._currentBlock] = str;\r\n        } else {\r\n            this._result[this._currentBlock] += str;\r\n        }\r\n    }\r\n\r\n    _append(str) {\r\n        if (str instanceof RawString) {\r\n            this._appendRaw(str);\r\n        } else {\r\n            this._appendRaw(this._template.arc.escape(str));\r\n        }\r\n    }\r\n\r\n    raw(str) {\r\n        return new RawString(str);\r\n    }\r\n\r\n    _partial(path) {\r\n        return Template.fromFile(this._template.arc, this._template.joinedPath(path)).evaluate(this.data);\r\n    }\r\n}\r\n\r\nexport default Context;"],"sourceRoot":"/source/"}